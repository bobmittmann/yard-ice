<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright (c) Bob Mittmann 2014-2015"/>
<link rel="shortcut icon" href="/img/thinkos16x16.png"/>
<link rel="stylesheet" href="layout.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>

<title>CRAB Device Simulator - Tools</title>

<script src="zepto.min.js"></script>
<script src="simlib.js"></script>

<script>	
	function get_port_status(port) {
		var row = $('#stat' + port)[0];		
		simlib_status_get(port, row);
	}

	function status_poll() {
//		setTimeout(status_poll, 5000);
		get_port_status(1);
		get_port_status(2);
		get_port_status(3);
		get_port_status(4);
		get_port_status(5);
	}

	function firmware_upload(event) {
		var form = this;
		var msg_box = form.querySelector('#__msg');
		var port = $('#selport').val();
		
		alert_show(msg_box, "Uploading firmware, please wait...");
		$('.button').prop('disabled', true);
		$.ajax({
			url: 'firmware_load.cgi?port=' + port,
			type: 'POST',
			data: new FormData(this),
			processData: false,
			contentType: false,
			success: function() {
			},
			error: function(xhr, type){
				alert('Ajax error!');
			},
			complete: function(xhr, status){
				alert_hide(msg_box);
				$('.button').prop('disabled', false);
			}
		});
		event.preventDefault();
	}

	$(function() {
        $('#btnrefresh').on('click', status_poll);
		$('#formfirm').on('submit', firmware_upload);
		status_poll();
    });

</script>
</head>

<body>

<div class="wrapper">	
	<section>
		<h2>Ports Status</h2>
		<table class="zebra">
			<thead>
				<tr>
				<th>Port</th>
				<th>Status</th>
				<th>Kernel</th>
				<th>Ticks</th>		
				<th>Firmware</th>
				<th>Uptime</th>
				</tr>
			</thead>
			<tbody>			
				<tr id="stat1">
					<td>1</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>		
				</tr>
				<tr id="stat2">
					<td>2</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>		
				</tr>	
				<tr id="stat3">
					<td>3</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>		
				</tr>	
				<tr id="stat4">
					<td>4</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>		
				</tr>	
				<tr id="stat5">
					<td>5</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>
					<td>...</td>				
				</tr>
			</tbody>		
		</table>
		<input id="btnrefresh" type="button" class="button" value="Refresh..." />
	</section>

	<h2>Firmware upgrade</h2>

	<section>	
	<form id="formfirm" enctype="multipart/form-data" action="firmware_load.cgi">
		<div>
		<table class="formgrid">
		<tr>
			<td style="text-align: right;">Simulator:</td>
			<td>
				<select id="selport">
					<option value="1">Port 1</option>
					<option value="2">Port 2</option>
					<option value="3">Port 3</option>
					<option value="4">Port 4</option>
					<option value="5">Port 5</option>
				</select>		
			</td>
		</tr>
		<tr>
			<td style="text-align: right;">Firmware:</td>
			<td>
			<input type="text" class="text" id="__fname"
				readonly="readonly" maxlength="128" size="20" /> <input
				type="button" class="button" value="Browse..."
				onclick="javascript: this.form.elements.namedItem('__browse').click()" />
			<input type="file" class="hidden" id="__browse" name="fname"
				onchange="javascript: this.form.elements.namedItem('__fname').value = this.value" />
			</td>
		</tr>
		<tr>
			<td></td>
			<td> 
			<input type="submit" class="button" value="Upload..." />
			</td>
		</tr>	
		</table>				
		</div>
		<div>
			<p id="__msg"></p>
		</div>		
	</form>

	</section>
</div>

<header>
	<h1>CRAB Simulator Firmware</h1>		
</header>

<nav>
	<div class="top"></div>
	<div class="tabs"><ul>
		<li><a class="top" href="index.html">Home</a></li>
		<li><a href="network.html">Network</a></li>				
		<li><a href="sim_database.html">Database</a></li>
		<li><a href="sim_config.html">Config</a></li>
		<li><a href="sim_monitor.html">Monitor</a></li>
		<li><a href="sim_tools.html">Tools</a></li>
		<li><a href="sim_diag.html">Diagnostics</a></li>
		<li><a href="sim_script.html">Scripts</a></li>
		<li><a href="sim_test.html">Tests</a></li>
		<li><a class="active" href="#"">Firmware</a></li>	
		<li><a href="sim_debug.html">Debug</a></li>			
	</ul></div>
	<div class="bot"></div>
</nav>

<footer>
	<a href="https://https://github.com/bobmittmann/yard-ice">
	<img src="/img/thinkos47x20.png"></a> - Cortex-M Operating System -
	<i><a href="https://https://github.com/bobmittmann/yard-ice">YARD-ICE</a></i><br />
	&copy; Copyright 2013-2015, Bob Mittmann
</footer>

</body>
</html>
