<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright (c) Bob Mittmann 2014-2015"/>
<link rel="shortcut icon" href="/img/thinkos16x16.png"/>
<link rel="stylesheet" href="layout.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>

<title>CRAB Simulator Tools</title>

<script src="zepto.min.js"></script>
<script src="simlib.js"></script>

<script>
	function get_stdout() {
		var port = $('#selport').val();
		var pre = $('#results');
		simlib_stdout_flush(port, pre);
	};

	function get_status() {
		var port = $('#selport').val();
		var row = $('#stat')[0];
		simlib_status_get(port, row);
	}

	function cmd_exec() {
		var port = $('#selport').val();
		var cmd = $('#cmd').val();
		$('.button').prop('disabled', true);
		$.ajax({
	 		type: 'GET',
			url: 'rpc_exec.cgi',
			data: { 
				port: port,
				cmd: cmd
	 		},
			dataType: 'text',
			timeout: 5000,
			context: $('body'),
			success: function(data) {
//	 			$('#results').empty();
//	   			$('#results').text(data);
	   		},
			error: function(xhr, type){ 
				alert('Ajax error!');
				stdout_flush_tmo = 5000;
			},
			complete: function(xhr, status){
				$('.button').prop('disabled', false);
			}
		});
	};

	function rpc_js() {		
		var port = $('#selport').val();
		var script = $('#script').val();
		$('.button').prop('disabled', true);
		simlib_js_post(port, script);
		$('.button').prop('disabled', false);
	};
	
	$(function() {
		$('#selport').on('change', get_status);
		$('#btnexec').on('click',  cmd_exec);
		$('#btnjs').on('click', rpc_js);
		get_status();
		get_stdout();
	});
</script>

</head>

<body>
<div class="wrapper">	
	<section>
		<h2>Port Status</h2>
		<table>
			<thead>
				<tr>
				<th>Port</th>
				<th>Status</th>
				<th>Kernel</th>
				<th>Ticks</th>		
				<th>Firmware</th>
				<th>Uptime</th>
				</tr>
			</thead>
			<tr id="stat">
				<td>
				<select id="selport" style="border: 0;">
					<option value="1">Port 1</option>
					<option value="2">Port 2</option>
					<option value="3">Port 3</option>
					<option value="4">Port 4</option>
					<option value="5">Port 5</option>
				</select>
				</td>		
				<td>...</td>
				<td>...</td>
				<td>...</td>
				<td>...</td>
				<td>...</td>						
			</tr>
		</table>
	</section>

	<section>
		<h2>Script</h2>

		<table class="formgrid" style="width: 100%; table-layout: fixed;">
		<col width="70%">
	  	<col width="30%">
		<tr>
			<td colspan="2">
			<pre id="results" style="height: 16em;"></pre>		
			</td>
		</tr>
		<tr>		
			<td>
			<input type="text" id="cmd" value="help" list="browsers" 
			style="width: 100%; font-family: monospace;"/>
			<datalist id="browsers">
				<option value="help">
				<option value="ls">
				<option value="rm cfg.bin">
				<option value="rm db.bin">
				<option value="disable sens all">
				<option value="disable mod all">
				<option value="disable sens 1 2 3">
				<option value="disable mod 1 2 3">
				<option value="enable mod 1 2 3">
				<option value="enable mod 1 2 3">
			</datalist>
			</td>
			<td style="vertical-align: top;">		
			<button id="btnexec" class="button">Exec...</button>
			</td>
		</tr>
		<tr>
			<td>	
<textarea id="script" autocomplete="off" wrap="logical" spellcheck="false" style="width: 100%; height: 12em;">
var i, j;

for(j = 0; j &lt; 200; j = j + 1) {
  printf("\n%4d: ", j);		
  for(i = 0; i &lt; 20; i = i + 1) {
    printf("%4d",i);
  }
}
</textarea>
		</td>
		<td style="vertical-align: top;">						
		<button id="btnjs" class="button">Run Script...</button>
		</td>
	</tr>
	</table>
	</section>
			
</div>
	
	<header>
		<h1>CRAB Simulator Tools</h1>
	</header>


<nav>
	<div class="top"></div>
	<div class="tabs"><ul>
		<li><a class="top" href="index.html">Home</a></li>
		<li><a href="network.html">Network</a></li>				
		<li><a href="sim_database.html">Database</a></li>
		<li><a href="sim_config.html">Config</a></li>
		<li><a href="sim_monitor.html">Monitor</a></li>
		<li><a class="active" href="#">Tools</a></li>
		<li><a href="sim_diag.html">Diagnostics</a></li>
		<li><a href="sim_script.html">Scripts</a></li>
		<li><a href="sim_test.html">Tests</a></li>
		<li><a href="sim_firmware.html">Firmware</a></li>
		<li><a href="sim_debug.html">Debug</a></li>			
	</ul>
	</div><div class="bot"></div>
</nav>

<footer>
	<a href="https://https://github.com/bobmittmann/yard-ice">
	<img src="/img/thinkos47x20.png"></a> - Cortex-M Operating System -
	<i><a href="https://https://github.com/bobmittmann/yard-ice">YARD-ICE</a></i><br />
	&copy; Copyright 2013-2015, Bob Mittmann
</footer>	
