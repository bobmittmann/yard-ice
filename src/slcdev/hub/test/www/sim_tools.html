<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright (c) Bob Mittmann 2014-2015"/>
<link rel="shortcut icon" href="/img/thinkos16x16.png"/>
<link rel="stylesheet" href="layout.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>

<title>CRAB Simulator Tools</title>

<script src="zepto.min.js"></script>
<script src="simlib.js"></script>

<script>
	function get_stdout() {
		var port = $('#selport').val();
		var pre = $('#results');
		simlib_stdout_flush(port, pre);
	};

	function get_status(port) {
		var tr = $('#stat' + port);
		simlib_status_get(port, tr);
	}
	
	function status_poll() {
		setTimeout(status_poll, 5000);
		get_status(1);
		get_status(2);
		get_status(3);
		get_status(4);
		get_status(5);
	}

	function cmd_exec() {
		var port = $('#selport').val();
		var cmd = $('#cmd').val();
		$('.button').prop('disabled', true);
		$.ajax({
	 		type: 'GET',
			url: 'rpc_exec.cgi',
			data: { 
				port: port,
				cmd: cmd
	 		},
			dataType: 'text',
			timeout: 5000,
			context: $('body'),
			success: function(data) {
//	 			$('#results').empty();
//	   			$('#results').text(data);
	   		},
			error: function(xhr, type){ 
				alert('Ajax error!');
				stdout_flush_tmo = 5000;
			},
			complete: function(xhr, status){
				$('.button').prop('disabled', false);
			}
		});
	};

	function rpc_js() {		
		var port = $('#selport').val();
		var script = $('#script').val();
		$('.button').prop('disabled', true);
		simlib_js_post(port, script);
		$('.button').prop('disabled', false);
	};
	
	$(function() {
        $('#btnrefresh').on('click', status_poll);
		$('#formfirm').on('submit', firmware_upload);
		status_poll();
		$('#selport').on('change', get_stdout);
		get_stdout();
		stdout_flush_tmo = 500;
		$(document).on('click', '#btnexec', cmd_exec);
		$(document).on('click', '#btnjs', rpc_js);
	});
</script>

</head>

<body>
<div class="wrapper">
	<section>
		<table class="formgrid" style="width: 100%; table-layout: fixed;">
		<col width="70%">
	  	<col width="30%">
		<tr>
			<td colspan="2">
			<pre id="results" style="height: 10em;"></pre>		
			</td>
		</tr>
		<tr>		
			<td>
			<input type="text" id="cmd" value="help" list="browsers" 
			style="width: 100%; font-family: monospace;"/>
			<datalist id="browsers">
				<option value="help">
				<option value="ls">
				<option value="rm cfg.bin">
				<option value="rm db.bin">
				<option value="disable sens all">
				<option value="disable mod all">
				<option value="disable sens 1 2 3">
				<option value="disable mod 1 2 3">
				<option value="enable mod 1 2 3">
				<option value="enable mod 1 2 3">
			</datalist>
			</td>
			<td style="vertical-align: top;">		
			<button id="btnexec" class="button">Exec...</button>
			</td>
		</tr>
		<tr>
			<td>	
<textarea id="script" autocomplete="off" wrap="logical" spellcheck="false" style="width: 100%; height: 8em;">
var i;
		
for(i = 0; i &lt; 100; i = i + 1) {
&#09;printf("%d\n",i);
}
</textarea>
		</td>
		<td style="vertical-align: top;">						
		<button id="btnjs" class="button">Run Script...</button>
		</td>
	</tr>
	</table>
	</section>
			
</div>
	
	<header>
		<h1>CRAB Simulator Tools</h1>
	</header>


<nav>
	<div class="top"></div>
	<div class="tabs"><ul>
		<li><a class="top" href="index.html">Home</a></li>
		<li><a href="network.html">Network</a></li>				
		<li><a href="sim_database.html">Database</a></li>
		<li><a href="sim_config.html">Config</a></li>
		<li><a href="sim_monitor.html">Monitor</a></li>
		<li><a class="active" href="#">Tools</a></li>
		<li><a href="sim_diag.html">Diagnostics</a></li>
		<li><a href="sim_script.html">Scripts</a></li>
		<li><a href="sim_test.html">Tests</a></li>
		<li><a href="sim_firmware.html">Firmware</a></li>			
	</ul>
	</div><div class="bot"></div>
</nav>

<footer>
	<a href="https://https://github.com/bobmittmann/yard-ice">
	<img src="/img/thinkos47x20.png"></a> - Cortex-M Operating System -
	<i><a href="https://https://github.com/bobmittmann/yard-ice">YARD-ICE</a></i><br />
	&copy; Copyright 2013-2015, Bob Mittmann
</footer>	
