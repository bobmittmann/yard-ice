<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright (c) Bob Mittmann 2014-2015"/>
<link rel="shortcut icon" href="/img/thinkos16x16.png"/>
<link rel="stylesheet" href="layout.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>

<title>CRAB Simulator Tools</title>

<script src="zepto.min.js"></script>
<script src="simlib.js"></script>

<script>
	function get_stdout() {
		var port = $('#selport').val();
		var pre = $('#results');
		simlib_stdout_flush(port, pre);
	};

	function get_status() {
		var port = $('#selport').val();
		var row = $('#stat')[0];
		simlib_status_get(port, row);
	}

	function rpc_jsexec() {		
		var port = $('#selport').val();
		var script = $('#script').val();
		$('.button').prop('disabled', true);
		simlib_js_post(port, script);
		$('.button').prop('disabled', false);
	};

	function rpc_jsstop() {
		var port = $('#selport').val();
		simlib_microjs_ctl(port, 0);		
	}

	function clr_stdout() {
		var pre = $('#results')[0];
		pre.innerHTML = '';		
	};

	$(function() {
		$('#selport').on('change', get_status);
		$('#btnjs').on('click', rpc_jsexec);
		$('#btnstop').on('click', rpc_jsstop);
		$('#btnclr').on('click', clr_stdout);
		get_status();
		flushTmr = setInterval(get_stdout, 500);		
	});
</script>

</head>

<body>
<div class="wrapper">	
	<section>
		<h2>Port Status</h2>
		<table>
			<thead>
				<tr>
				<th>Port</th>
				<th>Status</th>
				<th>Kernel</th>
				<th>Ticks</th>		
				<th>Firmware</th>
				<th>Uptime</th>
				</tr>
			</thead>
			<tr id="stat">
				<td>
				<select id="selport" style="border: 0;">
					<option value="1">Port 1</option>
					<option value="2">Port 2</option>
					<option value="3">Port 3</option>
					<option value="4">Port 4</option>
					<option value="5">Port 5</option>
				</select>
				</td>		
				<td>...</td>
				<td>...</td>
				<td>...</td>
				<td>...</td>
				<td>...</td>						
			</tr>
		</table>
	</section>

	<section>
		<h2>MicroJS Script</h2>

		<table class="formgrid" style="width: 100%; table-layout: fixed;">
		<col width="70%">
	  	<col width="30%">
		<tr style="height: 100%;">
			<td colspan="2">
			<pre id="results" style="height: 20em;"></pre>		
			</td>
		</tr>
		<tr>
			<td>	
<textarea id="script" autocomplete="off" wrap="logical" spellcheck="false" style="width: 100%; height: 12em;">
var i, j;

for(j = 0; j &lt; 200; j = j + 1) {
  printf("\n%4d: ", j);		
  for(i = 0; i &lt; 20; i = i + 1) {
    printf("%4d",i);
  }
}
</textarea>
		</td>
		<td style="vertical-align: top;">						
		<button id="btnjs" class="button">Run...</button> <br />
		<button id="btnstop" class="button">Stop</button> <br />
		<button id="btnclr" class="button">Clear</button>
		</td>
	</tr>
	</table>
	</section>
			
</div>
	
	<header>
		<h1>CRAB Simulator Tools</h1>
	</header>


<nav>
	<div class="top"></div>
	<div class="tabs"><ul>
		<li><a class="top" href="index.html">Home</a></li>
		<li><a href="network.html">Network</a></li>				
		<li><a href="sim_database.html">Database</a></li>
		<li><a href="sim_config.html">Config</a></li>
		<li><a href="sim_monitor.html">Monitor</a></li>
		<li><a class="active" href="#">Tools</a></li>
		<li><a href="sim_diag.html">Diagnostics</a></li>
		<li><a href="sim_script.html">Scripts</a></li>
		<li><a href="sim_test.html">Tests</a></li>
		<li><a href="sim_firmware.html">Firmware</a></li>
		<li><a href="sim_debug.html">Debug</a></li>			
	</ul>
	</div><div class="bot"></div>
</nav>

<footer>
	<a href="https://https://github.com/bobmittmann/yard-ice">
	<img src="/img/thinkos47x20.png"></a> - Cortex-M Operating System -
	<i><a href="https://https://github.com/bobmittmann/yard-ice">YARD-ICE</a></i><br />
	&copy; Copyright 2013-2015, Bob Mittmann
</footer>	
