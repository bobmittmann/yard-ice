<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright (c) Bob Mittmann 2014-2015"/>
<link rel="shortcut icon" href="/img/thinkos16x16.png"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>

<title>CRAB Device Simulator - RPC Test</title>

<script src="/lib/modalbox.js.gz"></script>
<script src="/lib/zepto.js.gz"></script>
<script>
	function msg_show(msg) {
		var html = msg;
		document.getElementById("msg").innerHTML = html;
	}
	
	function upload_msg() {
		msg_show("Uploading firmware, please wait...");
	}
	
	function rpc_test(event) {
		$('#results').empty();
		$.ajax({
			type: 'GET',
			url: 'rpc_test.cgi',
			data: { 
				code: event.data.code,
				port: $('#selport').val(),
				addr: $('#addr').val(),
				size: $('#size').val(),
				fname: $('#fname').val()
			},
			dataType: 'text',
			timeout: 1000,
			context: $('body'),
			success: function(data) {
				$('#results').text(data);
			},
			error: function(xhr, type){
				$('#results').text('Ajax error!\n');
			}
		});
	}

	function form_post(event) {
		var lst = this.elements;
		var caption;
		
		$('#results').empty();
		$('#results').text(lst.length + '\n' + 
				lst.namedItem('__fname').value + '\n' +
				lst.namedItem('__browse').name);

//		msg_show("Uploading file, please wait...");
		
//		dlg.okSelected = function () {
//			dlg.hide(); 
//			window.location.assign('restore.html'); 
//		}
//		dlg.cancelSelected = function () { dlg.hide(); }

		caption = 'Uploading ' + lst.namedItem('__fname').value;
		dlg.show('upload_dlg', caption, 400, 100);
		
		$.ajax({
			url: this.action + '?port=' + $('#selport').val(),
			type: 'POST',
			data: new FormData( this ),
			processData: false,
			contentType: false
			});
		event.preventDefault();
		
		dlg.hide();
	}

	Zepto( document ).ready(function() {
		
        $('#btn1').on('click', { code: 1 }, rpc_test);
        $('#btn2').on('click', { code: 2 }, rpc_test);
        $('#btn3').on('click', { code: 3 }, rpc_test);
        $('#btn4').on('click', { code: 4 }, rpc_test);

		$('#formdb').submit(form_post);
		$('#formcfg').submit(form_post);
    });
		
//	dlg.init();
	

</script>
</head>

<body>
<h1>CRAB Device Simulator - RPC Test</h1>

<table>
	<thead>
		<tr>
		<th>Port</th>
		<th>Status</th>
		<th>Firmware</th>
		<th>Database</th>
		<th>Config</th>
		</tr>
	</thead>
	<tr>
		<td><b>Port 1</b></td>
		<td>...</td>
		<td>...</td>
		<td>...</td>
		<td>...</td>		
	</tr>
	<tr>
		<td><b>Port 2</b></td>
		<td>...</td>
		<td>...</td>
		<td>...</td>
		<td>...</td>		
	</tr>	
	<tr>
		<td><b>Port 3</b></td>
		<td>...</td>
		<td>...</td>
		<td>...</td>
		<td>...</td>		
	</tr>	
	<tr>
		<td><b>Port 4</b></td>
		<td>...</td>
		<td>...</td>
		<td>...</td>
		<td>...</td>		
	</tr>	
	<tr>
		<td><b>Port 5</b></td>
		<td>...</td>
		<td>...</td>
		<td>...</td>
		<td>...</td>		
	</tr>		
</table>

<table>
	<tr>
		<td>Simulator:</td>
		<td>
			<select id="selport">
				<option value="1">Port 1</option>
				<option value="2">Port 2</option>
				<option value="3">Port 3</option>
				<option value="4">Port 4</option>
				<option value="4">Port 5</option>
			</select>		
		</td>
		<td>
		</td>
		<td>
		</td>
		<td>
		</td>
		<td>
		</td>
	</tr>
	<tr>
		<td>File:</td>
		<td>
			<input id="fname" type="text" maxlength="100" size="10" value="cfg.js" />
		</td>
		<td>
		</td>		
		<td>
		</td>		
		<td>
			<input id="btn1" type="button" class="button" value="File Write" />		
		</td>
		<td>
			<input id="btn2" type="button" class="button" value="File Read" />
		</td>
	</tr>
	<tr>
		<td>Address:</td>
		<td>
			<input id="addr" type="text" maxlength="10" size="10" value="0x08010000" />
		</td>
		<td>Size:</td>
		<td>
			<input id="size" type="number" maxlength="3" size="3" min="1" max="512" value="128" />
		</td>		
		<td>
			<input id="btn3" type="button" class="button" value="Mem read" />	
		</td>
		<td>
			<input id="btn4" type="button" class="button" value="Test 4" />
		</td>
		<td>
		</td>		
	</tr>	
</table>

<pre>
	<div id="results" style="
	min-height: 200px; 
	border-style: solid; 
	border-width: 1px; 
	border-color: #111;">
	</div>
</pre>

<hr>
<h2>Database upload</h2>
<div class="form">
<form id="formdb" enctype="multipart/form-data" action="db_load.cgi">
	<div class="fbody">
	File:
	<input type="text" class="text" id="__fname" readonly="readonly" maxlength="128" size="20" />
	<input type="button" class="button" value="Browse..." 
		onclick="javascript: this.form.elements.namedItem('__browse').click()" />
	<input type="file" class="hidden" id="__browse" name="fname" 
		onchange="javascript: this.form.elements.namedItem('__fname').value = this.value" />
   </div>
   <div class="ffoot">
       <input type="reset" class="button" value="Reset" />
       <input type="submit" class="button" value="Upload..." />
   </div>
</form>
</div>
				
<hr>
<h2>Config upload</h2>
<div class="form">
<form id="formcfg" enctype="multipart/form-data" action="cfg_load.cgi">
	<div class="fbody">
	File:
	<input type="text" class="text" id="__fname" readonly="readonly" maxlength="128" size="20" />
	<input type="button" class="button" value="Browse..." 
		onclick="javascript: this.form.elements.namedItem('__browse').click()" />
	<input type="file" class="hidden" id="__browse" name="fname" 
		onchange="javascript: this.form.elements.namedItem('__fname').value = this.value" />
   </div>
   <div class="ffoot">
       <input type="reset" class="button" value="Reset" />
       <input type="submit" class="button" value="Upload..." />
   </div>
	
</form>
</div>

<div id="upload_dlg" class="dialog">
	<h1 id="title"></h1>
	<center>
		<div style="float:left">
		<img style="float:none;vertical-align:middle" src="alert.png" alt="Alert! "/>
		</div>
		<div>
		<p>Uploading file, please wait...</p> 
		</div>
	</center>
</div>

<hr>
<a href="https://github.com/bobmittmann/yard-ice"> <b>ThinkOS</b></a>
- Cortex-M Operating System - 
<i><a href="https://github.com/bobmittmann/yard-ice">YARD-ICE</a></i>
<br>&copy; Copyright 2013-2015, Bob Mittmann<br>

</body>
</html>

